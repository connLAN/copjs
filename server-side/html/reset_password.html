<!DOCTYPE html>
<html>
  <head>
    <title>Reset Password</title>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/all.min.css">
    
    <style>
        .form-group {
              margin-bottom: 1rem;
          }
          .form-group label {
              display: block;
              margin-bottom: 0.5rem;
          }
          .form-group input {
              width: 100%;
              padding: 0.5rem;
              border: 1px solid #ced4da;
              border-radius: 0.25rem;
              font-size: 1rem;
          }
          .form-group .input-group-append {
              cursor: pointer;
          }
          .form-group .input-group-append i {
              padding: 0.5rem;
          }
          .error {
              color: red;
              margin-top: 0.25rem;
          }



      body {
        font-family: Arial, sans-serif;
        background-image: url("snow.jpg");
        background-size: cover;
        background-position: center;
      }
      h1 {
        text-align: center;
        margin-top: 50px;
        color: #fff;
        text-shadow: 2px 2px 4px #000000;
      }
      form {
        max-width: 500px;
        margin: 0 auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      }
      label {
        display: block;
        margin-bottom: 10px;
      }
      input[type="email"],
      input[type="text"],
      input[type="password"] {
        width: 95%;
        /* max-width: 400px; */
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-bottom: 20px;
        font-size: 16px;
      }
      input[type="submit"] {
        background-color: #4CAF50;
        color: #fff;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
      }
      input[type="submit"]:hover {
        background-color: #3e8e41;
      }
      .error {
        color: red;
        margin-top: 5px;
      }
    </style>
  </head>
  <body>
    <h1>Reset Password</h1>
    <form  onsubmit="return validateForm()" method="post">
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required>

      <label for="token">Token:</label>
      <input type="text" id="token" name="token" required>

      <label for="password">New Password:</label>
      <div class="input-group">
        <input type="password" id="password" name="password" required class="form-control">
        <div class="input-group-append">
          <span class="input-group-text">
            <i class="fa fa-eye" id="toggle-password"></i>
          </span>
        </div>
      </div>
      <span class="error" id="password-error"></span>

      <label for="confirm-password">Confirm New Password:</label>
      <div class="input-group"> 
        <input type="password" id="confirm-password" name="confirm_password" required class="form-control">
        <div class="input-group-append">
          <span class="input-group-text">
            <i class="fa fa-eye" id="toggle-confirm-password"></i>
          </span>
        </div>
      </div>
      <span class="error" id="confirm-password-error"></span>

      <div>
        <label for="human-check">Human Check:</label>
        <span id="num1"></span> + <span id="num2"></span> =
        <input type="text" id="human-check" name="human_check" required>
        <span class="error" id="human-check-error"></span>
      </div>

      <input type="submit" value="Reset Password">
    </form>


    <script src="/js/jquery-3.5.1.slim.min.js"></script>
    <script src="/js/popper-base.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>

    <script>
      const togglePassword = document.getElementById('toggle-password');
      const inputPassword = document.getElementById('password');

      togglePassword.addEventListener('click', function() {
        if (inputPassword.type === 'password') {
          inputPassword.type = 'text';
          togglePassword.classList.remove('fa-eye');
          togglePassword.classList.add('fa-eye-slash');
        } else {
          inputPassword.type = 'password';
          togglePassword.classList.remove('fa-eye-slash');
          togglePassword.classList.add('fa-eye');
        }
      });

      const toggleConfirmPassword = document.getElementById('toggle-confirm-password');
      const inputConfirmPassword = document.getElementById('confirm-password');

      toggleConfirmPassword.addEventListener('click', function() {
        if (inputConfirmPassword.type === 'password') {
          inputConfirmPassword.type = 'text';
          toggleConfirmPassword.classList.remove('fa-eye');
          toggleConfirmPassword.classList.add('fa-eye-slash');
        } else {
          inputConfirmPassword.type = 'password';
          toggleConfirmPassword.classList.remove('fa-eye-slash');
          toggleConfirmPassword.classList.add('fa-eye');
        }
      });


        // Generate two random numbers between 1 and 10
        var num1 = Math.floor(Math.random() * 10) + 1;
        var num2 = Math.floor(Math.random() * 10) + 1;
  
        // Display the numbers in the form
        document.getElementById("num1").innerHTML = num1;
        document.getElementById("num2").innerHTML = num2;

      // verify form input
      function validateForm() {
        // alert('validateForm()');


        var humanCheck = document.getElementById("human-check").value;
        // alert('humanCheck is ' + humanCheck);

        var expected = num1 + num2;
        if (humanCheck != expected) {
          // alert('validateForm() 222 ');
          document.getElementById("human-check-error").innerHTML = "Incorrect answer";
          return false;
        }

        // alert('validateForm() 333 ');

        // check email, password, confirm password
        const password = document.getElementById('password').value;
        const confirm_password = document.getElementById('confirm-password').value;
        const password_error = document.getElementById('password-error');
        const confirm_password_error = document.getElementById('confirm-password-error');

        if (password != confirm_password) {
          password_error.textContent = 'Passwords do not match';
          confirm_password_error.textContent = 'Passwords do not match';
          return false;
        }

        return true;
      }


      const form = document.querySelector('form');
      form.addEventListener('submit', (e) => {
        e.preventDefault();

        // alert('form submit 000');

        if (!validateForm()) {
          console.log('!validateForm(): Invalid input');
          alert('!formValidate(): Invalid input');
          return;
        }else{
          console.log('formValidate(): Valid input');
          alert('formValidate(): Valid input');
          // return;
        }

        const email = document.getElementById('email').value;
        const token = document.getElementById('token').value;
        const password = document.getElementById('password').value;
        const confirm_password = document.getElementById('confirm-password').value;

        const data = {
          email: email,
          token: token,
          password: password
        };

        fetch('/reset_password000', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
          .then((response) => {
            console.log("response.status: " + response.status + " response.statusText: " + response.statusText);

            if(response.ok){
              alert('Password reset successfully');
              window.location.href = '/login';
            }else{
              alert('Password reset failed');
            }
            
          })
          .catch((error) => {
            console.log(error);
          });

          return;

        });

    </script>

  </body>
</html>