<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Add Course</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        h1 {
            margin: 0;
            padding: 1rem;
            background-color: #333;
            color: #fff;
        }

        form {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 2rem;
            padding: 2rem;
            border: 2px solid #333;
            border-radius: 1rem;
        }

        label {
            margin: 1rem;
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 0.5rem;
            margin: 0.5rem 0;
            border: 1px solid #ccc;
            border-radius: 0.25rem;
        }

        input[type="file"] {
            display: none;
        }

        .file-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 10rem;
            margin: 1rem 0;
            border: 2px dashed #ccc;
            border-radius: 1rem;
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: #333;
        }

        .file-preview {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 10rem;
            margin: 1rem 0;
            border: 2px solid #ccc;
            border-radius: 1rem;
            overflow: hidden;
        }

        .file-preview img,
        .file-preview video {
            max-width: 100%;
            max-height: 100%;
        }

        button[type="submit"] {
            padding: 0.5rem;
            margin: 1rem 0;
            border: none;
            border-radius: 0.25rem;
            background-color: #333;
            color: #fff;
            cursor: pointer;
        }

        button[type="submit"]:hover {
            background-color: #444;
        }
    </style>
</head>
<body>
    <h1>Add Course</h1>

<form id="upload-form" enctype="multipart/form-data">
  <div style="display: flex; flex-direction: row; align-items: center;">
    <label for="name" style="margin-right: 1rem; text-align: right;">Course Name:</label>
    <div style="display: flex; flex-direction: row;">
      <input type="text" id="name" name="Course name" required>
    </div>
  </div>

  <div style="display: flex; flex-direction: row; align-items: center;">
    <label for="description" style="margin-right: 1rem; text-align: right;">Description:</label>
    <div style="display: flex; flex-direction: row;">
      <textarea id="description" name="description" required></textarea>
    </div>
  </div>

  <div class="file-upload">
    <label for="image">Drag and drop files or click to select files</label>
    <input type="file" id="image" name="image" accept=".jpg,.jpeg,.png" required>
  </div>

  <div class="file-preview"></div>

  <button type="submit">Create Course</button>
</form>

<script>
  const form = document.getElementById('upload-form');
  const button = document.querySelector('button[type="submit"]');
  const fileUpload = document.querySelector('.file-upload');
  const filePreview = document.querySelector('.file-preview');
  const imageInput = document.getElementById('image');

  button.addEventListener('click', (event) => {
    event.preventDefault();

    const images = imageInput.files;

    if (images.length === 0) {
      alert('Please select at least one file');
      return;
    }

    alert('submit');
    // trigger submit event
    form.dispatchEvent(new Event('submit'));
  });

  fileUpload.addEventListener('dragover', (event) => {
    event.preventDefault();
    fileUpload.classList.add('dragover');
  });

  fileUpload.addEventListener('dragleave', (event) => {
    event.preventDefault();
    fileUpload.classList.remove('dragover');
  });

  fileUpload.addEventListener('drop', (event) => {
    event.preventDefault();
    fileUpload.classList.remove('dragover');

    const files = event.dataTransfer.files;

    for (let i = 0; i < files.length; i++) {
      const file = files[i];
      const reader = new FileReader();

      reader.onload = (event) => {
        const fileData = event.target.result;
        const fileType = file.type;

        if (fileType.startsWith('image/')) {
          filePreview.innerHTML += `<img src="${fileData}" alt="File preview">`;
        } else if (fileType.startsWith('video/')) {
          filePreview.innerHTML += `<video src="${fileData}" controls></video>`;
        }
      };

      reader.readAsDataURL(file);
    }

    // attach files to imageInput
    const fileList = new DataTransfer();
    fileList.items.add(files[0]);
    imageInput.files = fileList.files;
  });
  document.getElementById('image').addEventListener('change', (event) => {
    const file = event.target.files[0];
    const reader = new FileReader();

    reader.onload = (event) => {
      const fileData = event.target.result;
      const fileType = file.type;

      if (fileType.startsWith('image/')) {
        filePreview.innerHTML = `<img src="${fileData}" alt="File preview">`;
      } else if (fileType.startsWith('video/')) {
        filePreview.innerHTML = `<video src="${fileData}" controls></video>`;
      }
    };

    reader.readAsDataURL(file);
  });
  form.addEventListener('submit', (event) => {
    event.preventDefault();

    alert('submit');
    const name = document.getElementById('name').value;
    const description = document.getElementById('description').value;
    const images = imageInput.files;
    alert('submit 2');

    const formData = new FormData();
    formData.append('name', name);
    formData.append('author', 'admin');
    formData.append('description', description);
    alert('submit 3, images.length = ' + images.length );

    if (images.length > 0) {
      formData.append('image', images[0]);
    }
    alert('submit 4');

    fetch('/a000', {
      method: 'POST',
      body: formData
    })
    .then((response) => {
      alert(response.status + ' : ' + response.statusText);
      
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }

      return response.json();
    })
    .then((data) => {
      alert('Upload successful:', data);
      form.reset();
      filePreview.innerHTML = '';
      imageInput.value = '';
    })
    .catch((error) => {
      alert('Error uploading file:', error);
      console.error('Error uploading file:', error);
    });
  });
</script>


</body>
</html>